<?xml version="1.0"?>
<ruleset xmlns="http://windup.jboss.org/schema/jboss-ruleset" id="fuse" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://windup.jboss.org/schema/jboss-ruleset http://windup.jboss.org/schema/jboss-ruleset/windup-jboss-ruleset.xsd">
    <metadata>
        <description>
             This ruleset provides help for migrating from JBoss Fuse 6 to JBoss Fuse 7.
        </description>
        <dependencies>
            <addon id="org.jboss.windup.rules,windup-rules-javaee,2.4.0.Final" />
            <addon id="org.jboss.windup.rules,windup-rules-java,2.4.0.Final" />
            <addon id="org.jboss.windup.rules,windup-rules-xml,2.4.0.Final" />
        </dependencies>
        <sourceTechnology id="fuse" versionRange="[6]" />
        <targetTechnology id="fuse" versionRange="[7,)" />
        <tag>fuse</tag>
    </metadata>

    <rules>

        <!-- usage of fabric8v1 apis -->
        <rule id="fuse-001">
            <when>
                <javaclass references="io.fabric8.api.{*}"/>
            </when>
            <perform>
                <hint title="Fabric8 v1 classes have been removed" effort="1">
                    <message>You need to entirely remove references to Fabric8v1 classes</message>
                    <tag>fabric</tag>
                </hint>
            </perform>
        </rule>
        <!-- usage of fabric8v1 apis -->
        <rule id="fuse-002">
            <when>
                <filecontent filename="{*}.{extension}" pattern="{uri}"  />
            </when>
            <perform>
                <hint title="XML: Fabric8 v1 classes have been removed" effort="1">
                    <message>XML: Fabric8 v1 classes have been removed</message>
                    <tag>fabric</tag>
                    <tag>camel</tag>
                    <tag>java</tag>
                </hint>
            </perform>
            <where param="uri">
                <matches pattern="io.fabric8.api"/>
            </where>
            <where param="extension">
                <matches pattern="(xml|properties)"/>
            </where>
        </rule>
        <!-- usge of curatorframework exposed as an osgi service -->
        <!-- <reference id="curator" interface="org.apache.curator.framework.CuratorFramework"/> -->
        <rule id="fuse-003">
            <when>
                <xmlfile matches="//*[local-name()='reference']/@interface" xpathResultMatch='interface="org.apache.curator.framework.CuratorFramework.*' in="{*}.xml"/>
            </when>
            <perform>
                <hint title="CuratorFramework is no longer exposed as an OSGi service" effort="1" category-id="mandatory">
                    <message>CuratorFramework is no longer exposed as an OSGi service</message>
                    <tag>xml</tag>
                    <tag>fabric</tag>
                </hint>
            </perform>
        </rule>
        <!-- usage of fabric8v1 apis -->
        <rule id="fuse-004">
            <when>
                <javaclass references="org.apache.curator.framework.CuratorFramework"/>
            </when>
            <perform>
                <hint title="CuratorFramework is no longer exposed as an OSGi service" effort="1">
                    <message>CuratorFramework is no longer exposed as an OSGi service</message>
                    <tag>fabric</tag>
                </hint>
                <classification issue-display-mode="all" title="CuratorFramework reference" category-id="mandatory" effort="1">
                    <description>
                      <![CDATA[
                      JBOss Fuse runtime no longer exposes `org.apache.curator.framework.CuratorFramework` as an OSGi Service.
                      It's suggested to check if the occurrence matched by this rule is a direct instantiation or it was referring it via an OSGi service reference.
                      ]]>
                    </description>
                    <tag>webservice</tag>
                </classification>
            </perform>
        </rule>
    </rules>
</ruleset>
