<?xml version="1.0"?>
<ruleset id="camel" xmlns="http://windup.jboss.org/schema/jboss-ruleset" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://windup.jboss.org/schema/jboss-ruleset http://windup.jboss.org/schema/jboss-ruleset/windup-jboss-ruleset.xsd">
    <metadata>
        <description>
             This ruleset provides help for migrating Camel from JBoss Fuse 6 to JBoss Fuse 7.
        </description>
        <dependencies>
            <addon id="org.jboss.windup.rules,windup-rules-xml,2.4.0.Final" />
            <addon id="org.jboss.windup.rules,windup-rules-java,2.4.0.Final" />
        </dependencies>
        <sourceTechnology id="fuse" versionRange="[6]" />
        <targetTechnology id="fuse" versionRange="[7,)" />
        <tag>fuse</tag>
    </metadata>

    <rules>

        <!-- any node using fabric: in its uri attribute -->
        <rule id="camel-001">
            <when>
                <xmlfile matches="//*/@uri" xpathResultMatch='uri="fabric:.*' in="{*}.xml" />
            </when>
            <perform>
                <hint title="Deprecated Camel Component" effort="1" category-id="mandatory">
                    <message>Using Deprecated Fabric Component</message>
                    <tag>camel</tag>
                    <tag>xml</tag>
                    <tag>fabric</tag>
                </hint>
            </perform>
        </rule>

        <!-- look for customized fabric camel components -->        
        <rule id="camel-002">
            <when>
                <xmlfile matches="//*[local-name()='bean']/@class" xpathResultMatch='class="io.fabric8.camel.FabricComponent.*' in="{*}.xml"/>
            </when>
            <perform>
                <hint title="Defined Fabric Component" effort="1" category-id="mandatory">
                    <message>Defined Fabric Component</message>
                    <tag>camel</tag>
                    <tag>xml</tag>
                    <tag>fabric</tag>
                </hint>
            </perform>
        </rule>

        <rule id="camel-003">
            <when>
                <javaclass references="io.fabric8.camel.{*}"/>
            </when>
            <perform>
                <hint title="Fabric8 Camel components have been removed" effort="1">
                    <message>Fabric8 Camel components have been removed</message>
                    <tag>fabric</tag>
                    <tag>camel</tag>
                    <tag>java</tag>
                </hint>
            </perform>
        </rule>

        <rule id="camel-004">
            <when>
                <filecontent filename="{*}.{extension}" pattern="{uri}"  />
            </when>
            <perform>
                <hint title="Found usage of fabric: Fabric8 Camel components have been removed" effort="1">
                    <message>Found usage of fabric: Fabric8 Camel components have been removed</message>
                    <tag>fabric</tag>
                    <tag>camel</tag>
                    <tag>java</tag>
                </hint>
            </perform>
            <where param="uri">
                <matches pattern="fabric:"/>
            </where>
            <where param="extension">
                <matches pattern="(java)"/>
            </where>
        </rule>

    </rules>
</ruleset>
